<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Debug Failed to Fetch</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
            color: #333;
        }
        .debug-log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status { padding: 10px; margin: 10px 0; font-weight: bold; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>üîç Debug: Failed to Fetch ke Google Apps Script</h2>
    <p><strong>URL API:</strong> <code id="api-url">https://script.google.com/macros/s/.../exec</code></p>

    <input type="text" id="barcode" placeholder="Masukkan barcode atau test data" value="TEST123" />
    <button onclick="sendTest()">Uji Kirim</button>

    <div id="status" class="status"></div>

    <div class="debug-log" id="log"></div>

    <script>
        // Pastikan URL ini benar, ganti dengan URL Web App Anda
        const SPREADSHEET_API_URL = "https://script.google.com/macros/s/AKfycbzsiEvUAEO9J9qT9G-vX2MxVHhwuCDVY1ncx-6Oq43siG5XZK_0O6ARxcutRWYz-F3V/exec";

        const logEl = document.getElementById("log");
        const statusEl = document.getElementById("status");
        const apiUrlEl = document.getElementById("api-url");

        // Tampilkan URL
        apiUrlEl.textContent = SPREADSHEET_API_URL;

        function log(msg, isError = false) {
            const time = new Date().toLocaleTimeString();
            const entry = `[${time}] ${msg}\n`;
            logEl.innerHTML += entry;
            logEl.scrollTop = logEl.scrollHeight;

            if (isError) {
                statusEl.className = "status error";
                statusEl.innerHTML = "‚ùå Error: " + msg;
            } else {
                statusEl.className = "status success";
                statusEl.innerHTML = "‚úÖ " + msg;
            }
        }

        async function sendTest() {
            const barcode = document.getElementById("barcode").value.trim();
            if (!barcode) {
                log("‚ö†Ô∏è Barcode kosong!", true);
                return;
            }

            const data = {
                barcode: barcode,
                device: navigator.platform,
                timestamp: new Date().toISOString(),
            };

            log("üì§ Mengirim data ke: " + SPREADSHEET_API_URL);
            log("üì¶ Data: " + JSON.stringify(data));

            const startTime = Date.now();

            try {
                const response = await fetch(SPREADSHEET_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });

                const duration = Date.now() - startTime;

                log(`‚úÖ HTTP ${response.status} dalam ${duration}ms`);
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ö†Ô∏è Respons gagal: ${errorText}`, true);
                    return;
                }

                const result = await response.json();
                log(`‚úÖ Data dikirim: ${JSON.stringify(result)}`);
            } catch (err) {
                const duration = Date.now() - startTime;
                log(`‚ùå Gagal setelah ${duration}ms: ${err.message}`, true);
            }
        }
    </script>
</body>
</html>
